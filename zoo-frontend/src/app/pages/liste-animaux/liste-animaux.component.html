<h1>Liste des animaux</h1>

<button mat-raised-button color="primary" (click)="ajouterAnimal()">
  Ajouter un animal
</button>

<table mat-table [dataSource]="dataSource" class="mat-elevation-z8">
  <!-- Nom -->
  <ng-container matColumnDef="name">
    <th mat-header-cell *matHeaderCellDef>Nom</th>
    <td mat-cell *matCellDef="let element">{{ element.name }}</td>
  </ng-container>

  <!-- Espèce -->
  <ng-container matColumnDef="species">
    <th mat-header-cell *matHeaderCellDef>Espèce</th>
    <td mat-cell *matCellDef="let element">{{ element.species }}</td>
  </ng-container>

  <!-- Santé -->
  <ng-container matColumnDef="health">
    <th mat-header-cell *matHeaderCellDef>Santé</th>
    <td mat-cell *matCellDef="let element">
      <div class="health-display">
        <span class="health-value">{{ element.health ?? "Inconnu" }}%</span>
        <div class="health-bar">
          <div
            class="health-fill"
            [style.width.%]="element.health || 0"
            [class.healthy]="(element.health || 0) >= 70"
            [class.warning]="
              (element.health || 0) >= 30 && (element.health || 0) < 70
            "
            [class.danger]="(element.health || 0) < 30"
          ></div>
        </div>
      </div>
    </td>
  </ng-container>

  <!-- Action -->
  <ng-container matColumnDef="action">
    <th mat-header-cell *matHeaderCellDef>Action</th>
    <td mat-cell *matCellDef="let element">
      <button
        mat-button
        color="primary"
        [routerLink]="['/details', element.id]"
      >
        Détails
      </button>

      <button
        mat-button
        color="accent"
        (click)="soignerAnimal(element.id)"
        *ngIf="(element.health || 0) < 100"
      >
        Soigner
      </button>

      <button mat-button color="warn" (click)="relacherAnimal(element.id)">
        Relâcher
      </button>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
</table>

<style>
  .health-display {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .health-value {
    font-weight: bold;
    min-width: 50px;
  }

  .health-bar {
    width: 100px;
    height: 15px;
    background-color: #f0f0f0;
    border-radius: 8px;
    overflow: hidden;
  }

  .health-fill {
    height: 100%;
    transition: width 0.3s ease;
  }

  .health-fill.healthy {
    background-color: #4caf50;
  }

  .health-fill.warning {
    background-color: #ff9800;
  }

  .health-fill.danger {
    background-color: #f44336;
  }

  table {
    width: 100%;
    margin-top: 20px;
  }

  .mat-mdc-row:hover {
    background-color: #f5f5f5;
  }
</style>
